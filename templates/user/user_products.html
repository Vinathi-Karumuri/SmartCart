{% extends "base.html" %}
{% block content %}

<div class="main" style="flex-direction: column; align-items: flex-start; width:100%;">

    <h2 style="color:#1b1b1b; margin-bottom:15px;">All Products</h2>

    <!-- ðŸ”” Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% for category, message in messages %}
        <div class="flash {{ category }}">
            {{ message }}
        </div>
      {% endfor %}
    {% endwith %}

    <!-- ðŸ” SEARCH & FILTER BAR -->
    <div class="filter-bar">

        <form method="GET" action="/user/products" class="filter-form">
            <input type="text"
                   name="search"
                   placeholder="Search product..."
                   value="{{ request.args.get('search', '') }}">
            <button type="submit">Search</button>
        </form>

        <form method="GET" action="/user/products" class="filter-form">
            <select name="category">
                <option value="">All Categories</option>
                {% for cat in categories %}
                <option value="{{ cat.category }}"
                    {% if request.args.get('category') == cat.category %}selected{% endif %}>
                    {{ cat.category }}
                </option>
                {% endfor %}
            </select>
            <button type="submit">Filter</button>
        </form>

    </div>

    <!-- ðŸ”¹ PRODUCT CARDS -->
    <div style="display:flex; flex-wrap:wrap; gap:20px; margin-top:20px;">

        {% for product in products %}
        <div class="card"
             style="width:220px;
                padding:20px;
                text-align:center;
             ">

            <img src="{{ url_for('static',
                filename='uploads/product_images/' ~ product.image) }}"
                style="width:140px; height:100px; object-fit:contain; margin-bottom:10px;">

            <h3 style="margin:6px 0;">{{ product.name }}</h3>
            <p style="color:#555;">{{ product.category }}</p>
            <p><strong>â‚¹{{ product.price }}</strong></p>

            <a href="/user/product/{{ product.product_id }}"
               class="add-product-btn"
               style="margin-top:10px;">
                View Details
            </a>
        </div>
        {% endfor %}

    </div>

</div>

{% endblock %}